<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx (mats3 0.19.9-2023-05-04 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: io.mats3.spring.jms.tx, class: JmsMatsTransactionManager_JmsAndSpringManagedSqlTx">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.mats3.spring.jms.tx</a></div>
<h1 title="Class JmsMatsTransactionManager_JmsAndSpringManagedSqlTx" class="title">Class JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance"><a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html" title="class in io.mats3.impl.jms">io.mats3.impl.jms.JmsMatsTransactionManager_Jms</a>
<div class="inheritance">io.mats3.spring.jms.tx.JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</div>
</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="../../../impl/jms/JmsMatsStatics.html" title="interface in io.mats3.impl.jms">JmsMatsStatics</a></code>, <code><a href="../../../impl/jms/JmsMatsTransactionManager.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</span>
<span class="extends-implements">extends <a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html" title="class in io.mats3.impl.jms">JmsMatsTransactionManager_Jms</a></span></div>
<div class="block">Implementation of <a href="../../../impl/jms/JmsMatsTransactionManager.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager</code></a> that in addition to the JMS transaction keeps a Spring
 <code>PlatformTransactionManager</code> employing a JDBC DataSource for which it keeps transaction demarcation along with
 the JMS transaction, by means of <i>"Best Effort 1 Phase Commit"</i>. Note that you can choose between providing a
 DataSource, in which case this JmsMatsTransactionManager internally creates a <code>DataSourceTransactionManager</code>,
 or you can provide a <code>PlatformTransactionManager</code> employing a <code>DataSource</code> that you've created
 and employ externally (i.e. <code>DataSourceTransactionManager</code>, <code>JpaTransactionManager</code> or
 <code>HibernateTransactionManager</code>). In the case where you provide a <code>PlatformTransactionManager</code>,
 you should <i>definitely</i> wrap the DataSource employed when creating it by the method
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a>, so that you get lazy Connection fetching and so that Mats can know
 whether the SQL Connection was actually employed within a Mats Stage - this also elides the committing of an empty DB
 transaction if a Mats Stage does not actually employ a SQL Connection. Note that whether you use the wrapped
 DataSource or the non-wrapped DataSource when creating e.g. <code>JdbcTemplate</code>s does not matter, as Spring's
 <code>DataSourceUtils</code> and <code>TransactionSynchronizationManager</code> has an unwrapping strategy when retrieving the
 transactionally demarcated Connection.
 <p/>
 Explanation of <i>Best Effort 1 Phase Commit</i>:
 <ol>
 <li><b>JMS transaction is entered</b> (a transactional JMS Connection is always within a transaction)
 <li>JMS Message is retrieved.
 <li><b>SQL transaction is entered</b>
 <li>Code is executed, <i>including SQL statements and production of new "outgoing" JMS Messages.</i>
 <li><b>SQL transaction is committed - <font color="red">Any errors also rollbacks the JMS Transaction, so that none
 of them have happened.</font></b>
 <li><b>JMS transaction is committed.</b>
 </ol>
 Out of that order, one can see that if SQL transaction becomes committed, and then the JMS transaction fails, this
 will be a pretty bad situation. However, of those two transactions, the SQL transaction is absolutely most likely to
 fail, as this is where you can have business logic failures, concurrency problems (e.g. MS SQL's "Deadlock Victim"),
 integrity constraints failing etc - that is, failures in both logic and timing. On the other hand, the JMS
 transaction (which effectively boils down to <i>"yes, I received this message, and sent these"</i>) is much harder to
 fail, where the only situation where it can fail is due to infrastructure/hardware failures (exploding server / full
 disk on Message Broker). This is called "Best Effort 1PC", and is nicely explained in <a href="http://www.javaworld.com/article/2077963/open-source-tools/distributed-transactions-in-spring--with-and-without-xa.html?page=2">
 this article</a>. If this failure occurs, it will be caught and logged on ERROR level (by
 <a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html" title="class in io.mats3.impl.jms"><code>JmsMatsTransactionManager_Jms</code></a>) - and then the Message Broker will probably try to redeliver the message. Also
 read the <a href="http://activemq.apache.org/should-i-use-xa.html">Should I use XA Transactions</a> from Apache
 Active MQ.
 <p/>
 Wise tip when working with <i>Message Oriented Middleware</i>: Code idempotent! Handle double-deliveries!
 <p/>
 The transactionally demarcated SQL Connection can be retrieved from within Mats Stage lambda code user code using
 <a href="../../../MatsEndpoint.ProcessContext.html#getAttribute(java.lang.Class,java.lang.String...)"><code>ProcessContext.getAttribute(Connection.class)</code></a> - which also is
 available using <a href="../../../MatsFactory.ContextLocal.html#getAttribute(java.lang.Class,java.lang.String...)"><code>ContextLocal.getAttribute(Connection.class)</code></a>.
 <b>Notice:</b> In a Spring context, you can also get the transactionally demarcated thread-bound Connection via
 <code>DataSourceUtils.getConnection(dataSource)</code> - this is indeed what
 Spring's JDBC Template and friends are doing. <b>If you go directly to the DataSource, you will get a new Connection
 not participating in the transaction!</b> This "feature" might sometimes be of interest if you want something to be
 performed regardless of whether the stage processing fails or not. <i>(However, if you do such a thing, you must
 remember the built-in retry mechanism JMS Message Brokers has: If something fails, whatever database changes you
 performed successfully with such a non-tx-managed Connection will not participate in the rollback, and will already
 have been performed when the message is retried. This might, or might not, be what you want.).</i></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected static class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.DeferredConnectionProxyDataSourceWrapper_InfrastructureProxy.html" class="type-name-link" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.DeferredConnectionProxyDataSourceWrapper_InfrastructureProxy</a></code></div>
<div class="col-last even-row-color">
<div class="block">Extension of <a href="../../../util/wrappers/DeferredConnectionProxyDataSourceWrapper.html" title="class in io.mats3.util.wrappers"><code>DeferredConnectionProxyDataSourceWrapper</code></a> which implements <code>InfrastructureProxy</code>.</div>
</div>
</div>
<div class="inherited-list">
<h2 id="nested-classes-inherited-from-class-io.mats3.impl.jms.JmsMatsTransactionManager_Jms">Nested classes/interfaces inherited from class&nbsp;io.mats3.impl.jms.<a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html" title="class in io.mats3.impl.jms">JmsMatsTransactionManager_Jms</a></h2>
<code><a href="../../../impl/jms/JmsMatsTransactionManager_Jms.TransactionalContext_Jms.html" title="class in io.mats3.impl.jms">JmsMatsTransactionManager_Jms.TransactionalContext_Jms</a></code></div>
<div class="inherited-list">
<h2 id="nested-classes-inherited-from-class-io.mats3.impl.jms.JmsMatsTransactionManager">Nested classes/interfaces inherited from interface&nbsp;io.mats3.impl.jms.<a href="../../../impl/jms/JmsMatsTransactionManager.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager</a></h2>
<code><a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>, <a href="../../../impl/jms/JmsMatsTransactionManager.ProcessingLambda.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.ProcessingLambda</a>, <a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.TransactionContext</a></code></div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color"><code><a href="#CONTEXT_LOCAL_KEY_CONNECTION_EMPLOYED_STATE_SUPPLIER" class="member-name-link">CONTEXT_LOCAL_KEY_CONNECTION_EMPLOYED_STATE_SUPPLIER</a></code></div>
<div class="col-last even-row-color">
<div class="block">A <code>Supplier&lt;Boolean&gt;</code> bound to <a href="../../../MatsFactory.ContextLocal.html" title="class in io.mats3"><code>MatsFactory.ContextLocal</code></a> when inside a Mats-transactional
 demarcation.</div>
</div>
</div>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-io.mats3.impl.jms.JmsMatsStatics">Fields inherited from interface&nbsp;io.mats3.impl.jms.<a href="../../../impl/jms/JmsMatsStatics.html" title="interface in io.mats3.impl.jms">JmsMatsStatics</a></h3>
<code><a href="../../../impl/jms/JmsMatsStatics.html#EXTRA_GRACE_MILLIS">EXTRA_GRACE_MILLIS</a>, <a href="../../../impl/jms/JmsMatsStatics.html#ILLEGAL_CALL_FLOWS">ILLEGAL_CALL_FLOWS</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_AUDIT">JMS_MSG_PROP_AUDIT</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_DISPATCH_TYPE">JMS_MSG_PROP_DISPATCH_TYPE</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_FROM">JMS_MSG_PROP_FROM</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_INITIALIZING_APP">JMS_MSG_PROP_INITIALIZING_APP</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_INITIATOR_ID">JMS_MSG_PROP_INITIATOR_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_MATS_MESSAGE_ID">JMS_MSG_PROP_MATS_MESSAGE_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_MESSAGE_TYPE">JMS_MSG_PROP_MESSAGE_TYPE</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_TO">JMS_MSG_PROP_TO</a>, <a href="../../../impl/jms/JmsMatsStatics.html#JMS_MSG_PROP_TRACE_ID">JMS_MSG_PROP_TRACE_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MAX_STACK_HEIGHT">MAX_STACK_HEIGHT</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MAX_TOTAL_CALL_NUMBER">MAX_TOTAL_CALL_NUMBER</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_APP_NAME">MDC_MATS_APP_NAME</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_APP_VERSION">MDC_MATS_APP_VERSION</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_CALL_NUMBER">MDC_MATS_CALL_NUMBER</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_IN_MESSAGE_SYSTEM_ID">MDC_MATS_IN_MESSAGE_SYSTEM_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_INIT">MDC_MATS_INIT</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_OUT_MATS_MESSAGE_ID">MDC_MATS_OUT_MATS_MESSAGE_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_STAGE">MDC_MATS_STAGE</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_STAGE_ID">MDC_MATS_STAGE_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_MATS_STAGE_INDEX">MDC_MATS_STAGE_INDEX</a>, <a href="../../../impl/jms/JmsMatsStatics.html#MDC_TRACE_ID">MDC_TRACE_ID</a>, <a href="../../../impl/jms/JmsMatsStatics.html#NO_INVOCATION_POINT">NO_INVOCATION_POINT</a>, <a href="../../../impl/jms/JmsMatsStatics.html#RANDOM_ALPHABET">RANDOM_ALPHABET</a>, <a href="../../../impl/jms/JmsMatsStatics.html#THREAD_PREFIX">THREAD_PREFIX</a>, <a href="../../../impl/jms/JmsMatsStatics.html#TOTAL_JMS_MSG_PROPS_SIZE">TOTAL_JMS_MSG_PROPS_SIZE</a></code></div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#create(javax.sql.DataSource)" class="member-name-link">create</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block"><b>Simplest, recommended if you do not need the PlatformTransactionManager in your Spring context!</b> - However,
 if you need the PlatformTransaction manager in the Spring context, then make it externally (typically using a
 @Bean annotated method, <i> and make sure to wrap the contained DataSource first with
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a></i>), and use the factory method
 <a href="#create(org.springframework.transaction.PlatformTransactionManager)"><code>create(PlatformTransactionManager)</code></a> (it will find the DataSource from the PlatformTransactionManager by
 introspection).</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#create(javax.sql.DataSource,java.util.function.Function)" class="member-name-link">create</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;&nbsp;transactionDefinitionFunction)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Creates an internal <code>DataSourceTransactionManager</code> for this created JmsMatsTransactionManager, and ensures
 that the supplied <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> is wrapped using the <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a>
 method.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#create(org.springframework.transaction.PlatformTransactionManager)" class="member-name-link">create</a><wbr>(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block"><b>Next simplest, recommended if you also need the PlatformTransactionManager in your Spring context!</b>
 (otherwise, use the <a href="#create(javax.sql.DataSource)"><code>create(DataSource)</code></a> factory method).</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#create(org.springframework.transaction.PlatformTransactionManager,java.util.function.Function)" class="member-name-link">create</a><wbr>(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;&nbsp;transactionDefinitionFunction)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Creates an instance of this class from a provided <code>PlatformTransactionManager</code> (of a type which manages a
 DataSource), where the supplied instance is introspected to find a method <code>getDataSource()</code> from where
 to get the underlying DataSource.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#create(org.springframework.transaction.PlatformTransactionManager,javax.sql.DataSource)" class="member-name-link">create</a><wbr>(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Creates a <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a> from a provided
 <code>PlatformTransactionManager</code> (of a type which manages a DataSource) - Do note that you should preferably
 have the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> within the <code><code>PlatformTransactionManager</code></code> wrapped using the
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> method.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#create(org.springframework.transaction.PlatformTransactionManager,javax.sql.DataSource,java.util.function.Function)" class="member-name-link">create</a><wbr>(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;&nbsp;transactionDefinitionFunction)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Creates a <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a> from a provided
 <code>PlatformTransactionManager</code> (of a type which manages a DataSource) - Do note that you should preferably
 have the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> within the <code><code>PlatformTransactionManager</code></code> wrapped using the
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> method.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getDataSource()" class="member-name-link">getDataSource</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getDataSourceUnwrapped()" class="member-name-link">getDataSourceUnwrapped</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>org.springframework.transaction.PlatformTransactionManager</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPlatformTransactionManager()" class="member-name-link">getPlatformTransactionManager</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#getStandardTransactionDefinitionFunctionFor(java.lang.Class)" class="member-name-link">getStandardTransactionDefinitionFunctionFor</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;? extends org.springframework.transaction.PlatformTransactionManager&gt;&nbsp;platformTransactionManager)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Returns the standard TransactionDefinition Function for the supplied PlatformTransactionManager.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.TransactionContext</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getTransactionContext(io.mats3.impl.jms.JmsMatsTransactionManager.JmsMatsTxContextKey)" class="member-name-link">getTransactionContext</a><wbr>(<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>&nbsp;txContextKey)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Provides an implementation of <a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.TransactionContext</code></a>.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)" class="member-name-link">wrapLazyConnectionDatasource</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;targetDataSource)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Creates a proxy/wrapper that has lazy connection getting, and monitoring of whether the connection was actually
 retrieved.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-io.mats3.impl.jms.JmsMatsTransactionManager_Jms">Methods inherited from class&nbsp;io.mats3.impl.jms.<a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html" title="class in io.mats3.impl.jms">JmsMatsTransactionManager_Jms</a></h3>
<code><a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html#create()">create</a></code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-io.mats3.impl.jms.JmsMatsStatics">Methods inherited from interface&nbsp;io.mats3.impl.jms.<a href="../../../impl/jms/JmsMatsStatics.html" title="interface in io.mats3.impl.jms">JmsMatsStatics</a></h3>
<code><a href="../../../impl/jms/JmsMatsStatics.html#createFlowId(long)">createFlowId</a>, <a href="../../../impl/jms/JmsMatsStatics.html#getInvocationPoint()">getInvocationPoint</a>, <a href="../../../impl/jms/JmsMatsStatics.html#id(java.lang.Object)">id</a>, <a href="../../../impl/jms/JmsMatsStatics.html#id(java.lang.String,java.lang.Object)">id</a>, <a href="../../../impl/jms/JmsMatsStatics.html#idThis()">idThis</a>, <a href="../../../impl/jms/JmsMatsStatics.html#ms3(double)">ms3</a>, <a href="../../../impl/jms/JmsMatsStatics.html#produceAndSendMsgSysMessages(org.slf4j.Logger,io.mats3.impl.jms.JmsMatsJmsSessionHandler.JmsSessionHolder,io.mats3.impl.jms.JmsMatsFactory,java.util.List)">produceAndSendMsgSysMessages</a>, <a href="../../../impl/jms/JmsMatsStatics.html#randomString(int)">randomString</a>, <a href="../../../impl/jms/JmsMatsStatics.html#setConcurrencyWithLog(org.slf4j.Logger,java.lang.String,java.util.function.Supplier,java.util.function.Supplier,java.util.function.Consumer,int)">setConcurrencyWithLog</a>, <a href="../../../impl/jms/JmsMatsStatics.html#stageOrInit(io.mats3.impl.jms.JmsMatsTransactionManager.JmsMatsTxContextKey)">stageOrInit</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="CONTEXT_LOCAL_KEY_CONNECTION_EMPLOYED_STATE_SUPPLIER">
<h3>CONTEXT_LOCAL_KEY_CONNECTION_EMPLOYED_STATE_SUPPLIER</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">CONTEXT_LOCAL_KEY_CONNECTION_EMPLOYED_STATE_SUPPLIER</span></div>
<div class="block">A <code>Supplier&lt;Boolean&gt;</code> bound to <a href="../../../MatsFactory.ContextLocal.html" title="class in io.mats3"><code>MatsFactory.ContextLocal</code></a> when inside a Mats-transactional
 demarcation.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../../constant-values.html#io.mats3.spring.jms.tx.JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.CONTEXT_LOCAL_KEY_CONNECTION_EMPLOYED_STATE_SUPPLIER">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="create(javax.sql.DataSource)">
<h3>create</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></span>&nbsp;<span class="element-name">create</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource)</span></div>
<div class="block"><b>Simplest, recommended if you do not need the PlatformTransactionManager in your Spring context!</b> - However,
 if you need the PlatformTransaction manager in the Spring context, then make it externally (typically using a
 @Bean annotated method, <i> and make sure to wrap the contained DataSource first with
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a></i>), and use the factory method
 <a href="#create(org.springframework.transaction.PlatformTransactionManager)"><code>create(PlatformTransactionManager)</code></a> (it will find the DataSource from the PlatformTransactionManager by
 introspection).
 <p/>
 Creates an internal <code>DataSourceTransactionManager</code> for this created JmsMatsTransactionManager, and ensures
 that the supplied <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> is wrapped using the <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a>
 method. Also with this way to construct the instance, Mats will know whether the stage or initiation actually
 performed any SQL data access.
 <p/>
 Uses a default <code>TransactionDefinition</code> Function, which sets the transaction name, sets Isolation Level to
 <code>TransactionDefinition.ISOLATION_READ_COMMITTED</code>, and sets Propagation Behavior to
 <code>TransactionDefinition.PROPAGATION_REQUIRES_NEW</code>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>dataSource</code> - the DataSource to make a <code>DataSourceTransactionManager</code> from - which will be wrapped using
            <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> if it not already is.</dd>
<dt>Returns:</dt>
<dd>a new <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a>.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="create(javax.sql.DataSource,java.util.function.Function)">
<h3>create</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></span>&nbsp;<span class="element-name">create</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;&nbsp;transactionDefinitionFunction)</span></div>
<div class="block">Creates an internal <code>DataSourceTransactionManager</code> for this created JmsMatsTransactionManager, and ensures
 that the supplied <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> is wrapped using the <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a>
 method. Also with this way to construct the instance, Mats will know whether the stage or initiation actually
 performed any SQL data access.
 <p/>
 Uses the supplied <code>TransactionDefinition</code> Function to define the transactions - consider
 <a href="#create(javax.sql.DataSource)"><code>create(DataSource)</code></a> if you are OK with the standard.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>dataSource</code> - the DataSource to make a <code>DataSourceTransactionManager</code> from - which will be wrapped using
            <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> if it not already is.</dd>
<dd><code>transactionDefinitionFunction</code> - a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link"><code>Function</code></a> which returns a <code>DefaultTransactionDefinition</code>, possibly based on the
            provided <a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.JmsMatsTxContextKey</code></a> (e.g. different isolation level for a special endpoint).</dd>
<dt>Returns:</dt>
<dd>a new <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a>.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="create(org.springframework.transaction.PlatformTransactionManager)">
<h3>create</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></span>&nbsp;<span class="element-name">create</span><wbr><span class="parameters">(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager)</span></div>
<div class="block"><b>Next simplest, recommended if you also need the PlatformTransactionManager in your Spring context!</b>
 (otherwise, use the <a href="#create(javax.sql.DataSource)"><code>create(DataSource)</code></a> factory method). Creates an instance of this class from a
 provided <code>PlatformTransactionManager</code> (of a type which manages a DataSource), where the supplied instance
 is introspected to find a method <code>getDataSource()</code> from where to get the underlying DataSource. <b>Do
 note that you should preferably have the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> within the
 <code><code>PlatformTransactionManager</code></code> wrapped using the
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> method.</b> If not wrapped as such, Mats will not be able to
 know whether the stage or initiation actually performed data access.
 <p/>
 Uses the standard <code>TransactionDefinition</code> Function, which sets the transaction name, sets Isolation Level
 to <code>TransactionDefinition.ISOLATION_READ_COMMITTED</code> (unless HibernateTxMgr), and sets Propagation Behavior
 to <code>TransactionDefinition.PROPAGATION_REQUIRES_NEW</code> - see
 <a href="#getStandardTransactionDefinitionFunctionFor(java.lang.Class)"><code>getStandardTransactionDefinitionFunctionFor(Class)</code></a>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>platformTransactionManager</code> - the <code>DataSourceTransactionManager</code> to use for transaction management.</dd>
<dt>Returns:</dt>
<dd>a new <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a>.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="create(org.springframework.transaction.PlatformTransactionManager,java.util.function.Function)">
<h3>create</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></span>&nbsp;<span class="element-name">create</span><wbr><span class="parameters">(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;&nbsp;transactionDefinitionFunction)</span></div>
<div class="block">Creates an instance of this class from a provided <code>PlatformTransactionManager</code> (of a type which manages a
 DataSource), where the supplied instance is introspected to find a method <code>getDataSource()</code> from where
 to get the underlying DataSource. <b>Do note that you should preferably have the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> within the
 <code><code>PlatformTransactionManager</code></code> wrapped using the
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> method.</b> If not wrapped as such, Mats will not be able to
 know whether the stage or initiation actually performed data access.
 <p/>
 Uses the supplied <code>TransactionDefinition</code> Function to define the transactions - consider
 <a href="#create(org.springframework.transaction.PlatformTransactionManager)"><code>create(PlatformTransactionManager)</code></a> if you are OK with the standard.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>platformTransactionManager</code> - the <code>DataSourceTransactionManager</code> to use for transaction management.</dd>
<dt>Returns:</dt>
<dd>a new <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a>.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="create(org.springframework.transaction.PlatformTransactionManager,javax.sql.DataSource)">
<h3>create</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></span>&nbsp;<span class="element-name">create</span><wbr><span class="parameters">(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource)</span></div>
<div class="block">Creates a <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a> from a provided
 <code>PlatformTransactionManager</code> (of a type which manages a DataSource) - Do note that you should preferably
 have the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> within the <code><code>PlatformTransactionManager</code></code> wrapped using the
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> method. If not wrapped as such, Mats will not be able to know
 whether the stage or initiation actually performed data access.
 <p/>
 <b>Note: Only use this method if the variants NOT taking a DataSource fails to work.</b> It is imperative that
 the DataSource and the PlatformTransactionManager provided "match up", meaning that the DataSource provided is
 actually the instance which the PlatformTransactionManager handles.
 <p/>
 Uses the standard <code>TransactionDefinition</code> Function, which sets the transaction name, sets Isolation Level
 to <code>TransactionDefinition.ISOLATION_READ_COMMITTED</code> (unless HibernateTxMgr), and sets Propagation Behavior
 to <code>TransactionDefinition.PROPAGATION_REQUIRES_NEW</code> - see
 <a href="#getStandardTransactionDefinitionFunctionFor(java.lang.Class)"><code>getStandardTransactionDefinitionFunctionFor(Class)</code></a>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>platformTransactionManager</code> - the <code>DataSourceTransactionManager</code> to use for transaction management.</dd>
<dd><code>dataSource</code> - the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> which the supplied <code>PlatformTransactionManager</code> handles.</dd>
<dt>Returns:</dt>
<dd>a new <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a>.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="create(org.springframework.transaction.PlatformTransactionManager,javax.sql.DataSource,java.util.function.Function)">
<h3>create</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx">JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</a></span>&nbsp;<span class="element-name">create</span><wbr><span class="parameters">(org.springframework.transaction.PlatformTransactionManager&nbsp;platformTransactionManager,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;dataSource,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;&nbsp;transactionDefinitionFunction)</span></div>
<div class="block">Creates a <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a> from a provided
 <code>PlatformTransactionManager</code> (of a type which manages a DataSource) - Do note that you should preferably
 have the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> within the <code><code>PlatformTransactionManager</code></code> wrapped using the
 <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a> method. If not wrapped as such, Mats will not be able to know
 whether the stage or initiation actually performed data access.
 <p/>
 <b>Note: Only use this method if the variants NOT taking a DataSource fails to work.</b> It is imperative that
 the DataSource and the PlatformTransactionManager provided "match up", meaning that the DataSource provided is
 actually the instance which the PlatformTransactionManager handles.
 <p/>
 Uses the supplied <code>TransactionDefinition</code> Function to define the transactions - consider
 <a href="#create(org.springframework.transaction.PlatformTransactionManager,javax.sql.DataSource)"><code>create(PlatformTransactionManager, DataSource)</code></a> if you are OK with the standard.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>platformTransactionManager</code> - the <code>PlatformTransactionManager</code> to use for transaction management (must be one employing a
            DataSource).</dd>
<dd><code>dataSource</code> - the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a> which the supplied <code>PlatformTransactionManager</code> handles.</dd>
<dd><code>transactionDefinitionFunction</code> - a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link"><code>Function</code></a> which returns a <code>DefaultTransactionDefinition</code>, possibly based on the
            provided <a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.JmsMatsTxContextKey</code></a> (e.g. different isolation level for a special endpoint).</dd>
<dt>Returns:</dt>
<dd>a new <a href="JmsMatsTransactionManager_JmsAndSpringManagedSqlTx.html" title="class in io.mats3.spring.jms.tx"><code>JmsMatsTransactionManager_JmsAndSpringManagedSqlTx</code></a>.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getStandardTransactionDefinitionFunctionFor(java.lang.Class)">
<h3>getStandardTransactionDefinitionFunctionFor</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Function.html" title="class or interface in java.util.function" class="external-link">Function</a>&lt;<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>,<wbr>org.springframework.transaction.support.DefaultTransactionDefinition&gt;</span>&nbsp;<span class="element-name">getStandardTransactionDefinitionFunctionFor</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;? extends org.springframework.transaction.PlatformTransactionManager&gt;&nbsp;platformTransactionManager)</span></div>
<div class="block">Returns the standard TransactionDefinition Function for the supplied PlatformTransactionManager. Sets Isolation
 Level to <code>ISOLATION_READ_COMMITTED</code> (unless
 HibernateTransactionManager, which does not support setting Isolation Level) and Propagation Behavior to
 <code>PROPAGATION_REQUIRES_NEW</code> - and also sets the name of the
 transaction to <a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.JmsMatsTxContextKey</code></a>.toString().</div>
</section>
</li>
<li>
<section class="detail" id="wrapLazyConnectionDatasource(javax.sql.DataSource)">
<h3>wrapLazyConnectionDatasource</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a></span>&nbsp;<span class="element-name">wrapLazyConnectionDatasource</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a>&nbsp;targetDataSource)</span></div>
<div class="block">Creates a proxy/wrapper that has lazy connection getting, and monitoring of whether the connection was actually
 retrieved. This again enables SpringJmsMats implementation to see if the SQL Connection was actually
 <i>employed</i> (i.e. a Statement was created) - not only whether we went into transactional demarcation, which a
 Mats stage <i>always</i> does. This method is internally employed with the <a href="#create(javax.sql.DataSource)"><code>DataSource-taking</code></a> factories of this class which makes an internal <code>DataSourceTransactionManager</code>, but
 should also be employed if you externally create another type of <code>PlatformTransactionManager</code>, e.g. the
 HibernateTransactionManager, and provide that to the factories of this class taking a PlatformTransactionManager.
 <p/>
 It returns an instance of <a href="../../../util/wrappers/DeferredConnectionProxyDataSourceWrapper.html" title="class in io.mats3.util.wrappers"><code>DeferredConnectionProxyDataSourceWrapper</code></a>, but as an extension that also
 implements Spring's <code>InfrastructureProxy</code>.
 <p/>
 We want this Lazy-and-Monitored DataSource which is returned here to "compare equals" with that of the DataSource
 which is supplied to us - and which might be employed by other components "on the outside" of Mats - wrt. how
 Spring's <code>DataSourceUtils</code> compare them in its ThreadLocal cache-hackery. Therefore, the proxy implement
 <code>InfrastructureProxy</code> (read its JavaDoc!), which means that Spring can trawl its way down to the actual
 DataSource when it needs to compare. Note: You will find this proxy-handling in the
 <code>TransactionSynchronizationManager.getResource(Object)</code>, which invokes
 <code>TransactionSynchronizationUtils.unwrapResourceIfNecessary(..)</code>, where the instanceof-check for
 InfraStructureProxy resides.
 <p/>
 <i>"The magnitude of this hack compares favorably with that of the US-of-A's national debt."</i>
 <p/>
 Note: It is not a problem if the DataSource supplied is already wrapped in a
 <code>LazyConnectionDataSourceProxy</code>, but it is completely unnecessary.
 <p/>
 Tip: If you would want to check/understand how the LazyConnection stuff work, you may within a Mats stage do a
 DataSourceUtil.getConnection(dataSource) - if the returned Connection's toString() looks like
 <code>"DeferredConnectionProxy@3ec11999 WITHOUT actual Connection from DataSource@3406472c..."</code> then the
 actual Connection is still not gotten. When it is gotten (e.g. after having done a SQL CRUD operation), the
 toString() will look like <code>"DeferredConnectionProxy@3ec11999 WITH actual Connection@b5cc23a"</code></div>
</section>
</li>
<li>
<section class="detail" id="getPlatformTransactionManager()">
<h3>getPlatformTransactionManager</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">org.springframework.transaction.PlatformTransactionManager</span>&nbsp;<span class="element-name">getPlatformTransactionManager</span>()</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the employed Spring <code>PlatformTransactionManager</code>, which either was created by this instance if this
         instance was created using one of the DataSource-taking factory methods, or it was provided if this
         instance was created using one of the PlatformTransactionManager-taking methods.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getDataSource()">
<h3>getDataSource</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a></span>&nbsp;<span class="element-name">getDataSource</span>()</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the employed <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link"><code>DataSource</code></a>, which either was provided when creating this instance (and thus
         wrapped), or was reflected out of the provided <code>PlatformTransactionManager</code>. It is hopefully
         wrapped using the <a href="#wrapLazyConnectionDatasource(javax.sql.DataSource)"><code>wrapLazyConnectionDatasource(DataSource)</code></a>, which is done automatically if this
         instance was created using one of the DataSource-taking factory methods. However, if this instance was
         created using one of the PlatformTransactionManager-taking factory methods, it is up to the user to have
         wrapped it. Note that it works unwrapped too, but SpringJmsMats cannot then know whether the stages
         actually employ the SQL Connection, and must do full transaction demarcation around every stage.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getDataSourceUnwrapped()">
<h3>getDataSourceUnwrapped</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html" title="class or interface in javax.sql" class="external-link">DataSource</a></span>&nbsp;<span class="element-name">getDataSourceUnwrapped</span>()</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the unwrapped variant of <a href="#getDataSource()"><code>getDataSource()</code></a> - note that it is only any <code>InfrastructureProxy</code>s
         that are unwrapped; Any wrapping done by a database pool is left intact.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getTransactionContext(io.mats3.impl.jms.JmsMatsTransactionManager.JmsMatsTxContextKey)">
<h3>getTransactionContext</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.TransactionContext</a></span>&nbsp;<span class="element-name">getTransactionContext</span><wbr><span class="parameters">(<a href="../../../impl/jms/JmsMatsTransactionManager.JmsMatsTxContextKey.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager.JmsMatsTxContextKey</a>&nbsp;txContextKey)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../../../impl/jms/JmsMatsTransactionManager.html#getTransactionContext(io.mats3.impl.jms.JmsMatsTransactionManager.JmsMatsTxContextKey)">JmsMatsTransactionManager</a></code></span></div>
<div class="block">Provides an implementation of <a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.TransactionContext</code></a>. (JMS Connection and Session handling is done by
 <a href="../../../impl/jms/JmsMatsJmsSessionHandler.html" title="interface in io.mats3.impl.jms"><code>JmsMatsJmsSessionHandler</code></a>).</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../../../impl/jms/JmsMatsTransactionManager.html#getTransactionContext(io.mats3.impl.jms.JmsMatsTransactionManager.JmsMatsTxContextKey)">getTransactionContext</a></code>&nbsp;in interface&nbsp;<code><a href="../../../impl/jms/JmsMatsTransactionManager.html" title="interface in io.mats3.impl.jms">JmsMatsTransactionManager</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html#getTransactionContext(io.mats3.impl.jms.JmsMatsTransactionManager.JmsMatsTxContextKey)">getTransactionContext</a></code>&nbsp;in class&nbsp;<code><a href="../../../impl/jms/JmsMatsTransactionManager_Jms.html" title="class in io.mats3.impl.jms">JmsMatsTransactionManager_Jms</a></code></dd>
<dt>Parameters:</dt>
<dd><code>txContextKey</code> - for which <a href="../../../impl/jms/JmsMatsStage.html" title="class in io.mats3.impl.jms"><code>JmsMatsStage</code></a> or <code>JmsMatsInitiator</code> this request for <a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.TransactionContext</code></a>
            is for.</dd>
<dt>Returns:</dt>
<dd>a <a href="../../../impl/jms/JmsMatsTransactionManager.TransactionContext.html" title="interface in io.mats3.impl.jms"><code>JmsMatsTransactionManager.TransactionContext</code></a> for the supplied txContextKey.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
