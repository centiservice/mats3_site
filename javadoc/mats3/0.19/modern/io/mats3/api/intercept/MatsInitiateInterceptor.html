<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>MatsInitiateInterceptor (mats3 0.19.9-2023-05-04 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: io.mats3.api.intercept, interface: MatsInitiateInterceptor">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.mats3.api.intercept</a></div>
<h1 title="Interface MatsInitiateInterceptor" class="title">Interface MatsInitiateInterceptor</h1>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Known Subinterfaces:</dt>
<dd><code><a href="MatsInitiateInterceptor.MatsInitiateInterceptOutgoingMessages.html" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.MatsInitiateInterceptOutgoingMessages</a></code></dd>
</dl>
<dl class="notes">
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="../../localinspect/LocalStatsMatsInterceptor.html" title="class in io.mats3.localinspect">LocalStatsMatsInterceptor</a></code>, <code><a href="../../intercept/logging/MatsMetricsLoggingInterceptor.html" title="class in io.mats3.intercept.logging">MatsMetricsLoggingInterceptor</a></code>, <code><a href="../../intercept/micrometer/MatsMicrometerInterceptor.html" title="class in io.mats3.intercept.micrometer">MatsMicrometerInterceptor</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">MatsInitiateInterceptor</span></div>
<div class="block"><b>Implement this interface to intercept Initiations</b>, then register with
 <a href="MatsInterceptable.html#addInitiationInterceptor(io.mats3.api.intercept.MatsInitiateInterceptor)"><code>MatsInterceptable.addInitiationInterceptor(MatsInitiateInterceptor)</code></a>.
 <p/>
 Meant for intercepting initiations with ability to modify the initiation, and to implement extra logging and metrics
 gathering.
 <p/>
 When more than one interceptor is installed, the ordering becomes interesting. If the following class is added twice,
 <b>first</b> with 1 as the argument, and then <b>secondly</b> with 2 as the argument ..:

 <pre>
 private static class MyMatsInitiateInterceptor implements MatsInitiateInterceptor {

     private final int _number;

     MyMatsInitiateInterceptor(int number) {
         _number = number;
     }

     &#64;Override
     public void initiateStarted(InitiateStartedContext initiateStartedContext) {
         log.info("Started #" + _number);
     }

     &#64;Override
     public void initiateIntercept(InitiateInterceptContext initiateInterceptContext,
             InitiateLambda initiateLambda, MatsInitiate matsInitiate) {
         log.info("Intercept pre #" + _number);

         // Wrap the MatsInitiate to catch "send(dto)", before invoking the lambda
         MatsInitiateWrapper wrappedMatsInitiate = new MatsInitiateWrapper(matsInitiate) {
             &#64;Override
             public MessageReference send(Object messageDto) {
                 log.info(".. send pre #" + _number);
                 MessageReference send = super.send(messageDto);
                 log.info(".. send post #" + _number);
                 return send;
             }
         };

         // Invoke the lambda, with the wrapped MatsInitiate
         initiateLambda.initiate(wrappedMatsInitiate);

         log.info("Intercept post #" + _number);
     }

     &#64;Override
     public void initiateCompleted(InitiateCompletedContext initiateCompletedContext) {
         log.info("Completed #" + _number);
     }
 }
 </pre>

 .. then the following sequence of log lines and operations ensues:
 <ol>
 <li>First the <a href="#initiateStarted(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateStartedContext)"><code>initiateStarted(..)</code></a> are invoked
 in sequence:</li>
 <li><code>Started #1</code></li>
 <li><code>Started #2</code></li>
 <li>Then the initiation goes into the transaction, and a "reverse stack" of lambdas are generated from the two
 interceptors'
 <a href="MatsInitiateInterceptor.MatsInitiateInterceptUserLambda.html#initiateInterceptUserLambda(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateInterceptUserLambdaContext,io.mats3.MatsInitiator.InitiateLambda,io.mats3.MatsInitiator.MatsInitiate)"><code>initiateIntercept(..)</code></a> methods, and then the resulting lambda is invoked:</li>
 <li><code>Intercept pre #1</code></li>
 <li><code>Intercept pre #2</code></li>
 <li>.. the actual user provided lambda (the one provided by the endpoint) is invoked, performing a
 <code>send(..)</code>, which goes through the stack of MatsInitiateWrappers which the
 <code>initiateIntercept(..)</code> invocations generated (thus hitting the last wrapping by #2 first):</li>
 <li><code>.. send pre #2</code></li>
 <li><code>.. send pre #1</code></li>
 <li>.. the actual Mats API send(..) method is invoked, before we traverse out of the MatsInitiateWrappers:</li>
 <li><code>.. send post #1</code></li>
 <li><code>.. send post #2</code></li>
 <li>.. and then the user lambda exits, traversing back up the <code>initiateIntercept(..)</code> stack</li>
 <li><code>Intercept post #2</code></li>
 <li><code>Intercept post #1</code></li>
 <li>Finally, the {link <a href="#initiateCompleted(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateCompletedContext)"><code>initiateComplete(..)</code></a> is invoked, in explicit reversed order:</li>
 <li><code>Completed #2</code></li>
 <li><code>Completed #1</code></li>
 </ol>
 If you envision that these two interceptors are created for logging, where the first interceptor puts values on the
 MDC, while the second one logs, then this makes a bit of sense: First the MDC is set, then an entry log line is
 emitted, then an exit log line is emitted, then the MDC is cleared. <b>However</b>, interceptions of the inner call
 from the actual user provided lambda to MatsInitiate.send(..) ends up in what is seemingly the "wrong"
 <i>sequential</i> order, due to how the interception is logically performed: The #2 is the <i>last</i>
 initiateIntercept(..) that is invoked, which thus is the code that <i>lastly</i> wraps the MatsInitiate instance, and
 hence when the user code invokes matsInitiate.send(..), that lastly added wrapping is the <i>first</i> to be
 executed. What this means, is that you should probably not make severe ordering dependencies between interceptors
 which depends on wrapping the MatsInitiate instance, as your head will most probably hurt from the ensuing twisted
 reasoning!
 <p/>
 <b>Note: This is only invoked for proper, actual initiations "from outside of Mats", i.e. using a
 <a href="../../MatsInitiator.html" title="interface in io.mats3"><code>MatsInitiator</code></a> gotten with <a href="../../MatsFactory.html#getDefaultInitiator()"><code>MatsFactory.getDefaultInitiator()</code></a> or
 <a href="../../MatsFactory.html#getOrCreateInitiator(java.lang.String)"><code>MatsFactory.getOrCreateInitiator(String)</code></a></b> <i>- and notice the special semantics of getDefaultInitiator(),
 whereby if such an seemingly "from the outside" initiation is invoked when code-flow-wise within a Stage, you will
 actually be "elevated" to be initiated "within Mats" using the Stage initiator - and hence this interceptor will not
 be invoked (it is no longer "from outside of Mats").</i>
 <p/>
 The concept of "outside" vs. "inside" perhaps seems subtle, but there is a distinct difference: No processing will
 ever happen in a Mats fabric if no initiations happens "from the outside": It is always a "from the outside"
 initiation that will set Mats flows in action. Such a process flow might then set several new Mats flows in action
 (i.e. initiations "from the inside"), but those are dependent on the initial Mats flow that was set in motion "from
 the outside", and would never have been initiated was it not for such initiation.
 <p/>
 To catch initiations "from the inside", you will employ a <a href="MatsStageInterceptor.html" title="interface in io.mats3.api.intercept"><code>MatsStageInterceptor</code></a>.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Interface</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="MatsInitiateInterceptor.InitiateCompletedContext.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateCompletedContext</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="MatsInitiateInterceptor.InitiateInterceptContext.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateInterceptContext</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="MatsInitiateInterceptor.InitiateInterceptOutgoingMessagesContext.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateInterceptOutgoingMessagesContext</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="MatsInitiateInterceptor.InitiateInterceptUserLambdaContext.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateInterceptUserLambdaContext</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="MatsInitiateInterceptor.InitiateStartedContext.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateStartedContext</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="MatsInitiateInterceptor.MatsInitiateInterceptOutgoingMessages.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.MatsInitiateInterceptOutgoingMessages</a></code></div>
<div class="col-last odd-row-color">
<div class="block">While still within the initiation context, this interception enables modifying outgoing messages from the user
 lambda, setting trace properties, adding "sideloads", deleting a message, or initiating additional messages.</div>
</div>
<div class="col-first even-row-color"><code>static interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="MatsInitiateInterceptor.MatsInitiateInterceptUserLambda.html" class="type-name-link" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.MatsInitiateInterceptUserLambda</a></code></div>
<div class="col-last even-row-color">
<div class="block">Enables the intercepting of the invocation of the user lambda in an Initiation, with ability to wrap the
 <a href="../../MatsInitiator.MatsInitiate.html" title="interface in io.mats3"><code>MatsInitiator.MatsInitiate</code></a> (and thus modify any request, send or publishes) - or even take over the entire initiation.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab5" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab5', 3)" class="table-tab">Default Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code>default void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code><a href="#initiateCompleted(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateCompletedContext)" class="member-name-link">initiateCompleted</a><wbr>(<a href="MatsInitiateInterceptor.InitiateCompletedContext.html" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateCompletedContext</a>&nbsp;context)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code>default void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code><a href="#initiateStarted(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateStartedContext)" class="member-name-link">initiateStarted</a><wbr>(<a href="MatsInitiateInterceptor.InitiateStartedContext.html" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateStartedContext</a>&nbsp;context)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5">
<div class="block">Invoked right before user lambda is invoked.</div>
</div>
</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="initiateStarted(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateStartedContext)">
<h3>initiateStarted</h3>
<div class="member-signature"><span class="modifiers">default</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">initiateStarted</span><wbr><span class="parameters">(<a href="MatsInitiateInterceptor.InitiateStartedContext.html" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateStartedContext</a>&nbsp;context)</span></div>
<div class="block">Invoked right before user lambda is invoked.</div>
</section>
</li>
<li>
<section class="detail" id="initiateCompleted(io.mats3.api.intercept.MatsInitiateInterceptor.InitiateCompletedContext)">
<h3>initiateCompleted</h3>
<div class="member-signature"><span class="modifiers">default</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">initiateCompleted</span><wbr><span class="parameters">(<a href="MatsInitiateInterceptor.InitiateCompletedContext.html" title="interface in io.mats3.api.intercept">MatsInitiateInterceptor.InitiateCompletedContext</a>&nbsp;context)</span></div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
